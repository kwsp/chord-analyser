var app=function(){"use strict";function t(){}function n(t){return t()}function e(){return Object.create(null)}function o(t){t.forEach(n)}function r(t){return"function"==typeof t}function i(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}function a(t,n){t.appendChild(n)}function c(t,n,e){t.insertBefore(n,e||null)}function u(t){t.parentNode.removeChild(t)}function s(t){return document.createElement(t)}function l(t){return document.createTextNode(t)}function f(){return l(" ")}function d(t,n,e,o){return t.addEventListener(n,e,o),()=>t.removeEventListener(n,e,o)}function h(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function p(t){return""===t?null:+t}function m(t,n){t.value=null==n?"":n}let g;function y(t){g=t}function b(t){(function(){if(!g)throw new Error("Function called outside component initialization");return g})().$$.on_mount.push(t)}const v=[],$=[],w=[],x=[],k=Promise.resolve();let A=!1;function _(t){w.push(t)}let C=!1;const M=new Set;function F(){if(!C){C=!0;do{for(let t=0;t<v.length;t+=1){const n=v[t];y(n),q(n.$$)}for(y(null),v.length=0;$.length;)$.pop()();for(let t=0;t<w.length;t+=1){const n=w[t];M.has(n)||(M.add(n),n())}w.length=0}while(v.length);for(;x.length;)x.pop()();A=!1,C=!1,M.clear()}}function q(t){if(null!==t.fragment){t.update(),o(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(_)}}const E=new Set;function N(t,n){-1===t.$$.dirty[0]&&(v.push(t),A||(A=!0,k.then(F)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function j(i,a,c,s,l,f,d,h=[-1]){const p=g;y(i);const m=i.$$={fragment:null,ctx:null,props:f,update:t,not_equal:l,bound:e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(p?p.$$.context:a.context||[]),callbacks:e(),dirty:h,skip_bound:!1,root:a.target||p.$$.root};d&&d(m.root);let b=!1;if(m.ctx=c?c(i,a.props||{},((t,n,...e)=>{const o=e.length?e[0]:n;return m.ctx&&l(m.ctx[t],m.ctx[t]=o)&&(!m.skip_bound&&m.bound[t]&&m.bound[t](o),b&&N(i,t)),n})):[],m.update(),b=!0,o(m.before_update),m.fragment=!!s&&s(m.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);m.fragment&&m.fragment.l(t),t.forEach(u)}else m.fragment&&m.fragment.c();a.intro&&((v=i.$$.fragment)&&v.i&&(E.delete(v),v.i($))),function(t,e,i,a){const{fragment:c,on_mount:u,on_destroy:s,after_update:l}=t.$$;c&&c.m(e,i),a||_((()=>{const e=u.map(n).filter(r);s?s.push(...e):o(e),t.$$.on_mount=[]})),l.forEach(_)}(i,a.target,a.anchor,a.customElement),F()}var v,$;y(p)}function I(t,n,e){t=t.map((t=>Math.sqrt(t)));const o=new Float32Array(12),r=(o,r,i)=>{const a=function(t,n,e,o,r){return Math.round(function(t){return T*Math.pow(2,t/12)}(t)*n*e/(o/r))}(i,o,r,n,e),c=a-2*r,u=a+2*r;return Math.max(...t.slice(c,u))};for(let t=0;t<12;t++)o[t]=r(1,1,t)+r(2,1,t)+(r(1,2,t)+r(2,2,t))/2;return o}const T=130.81;const D={maj:[1,0,0,0,1,0,0,1,0,0,0,0],maj7:[1,0,0,0,1,0,0,1,0,0,0,1],m:[1,0,0,1,0,0,0,1,0,0,0,0],m7:[1,0,0,1,0,0,0,1,0,0,1,0],7:[1,0,0,0,1,0,0,1,0,0,1,0],dim:[1,0,0,1,0,0,1,0,0,0,0,0]},S=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function U(t,n){return(t%n+n)%n}function z(t,n=1){const e=new Int8Array(t.length);for(let o=0;o<e.length;o++)e[o]=t[U(o-n,t.length)];return e}const B=function(){const t=Object.keys(D),n=S,e={};let o="C";for(const n of t){const t="maj"===n?o:o+n,r=new Uint8Array(D[n]),i=r.map((t=>t?0:1)),a=r.reduce(((t,n)=>n?t+1:t));e[t]={bitMask:r,invertedMask:i,nNotes:a}}for(let r=1;r<n.length;r++){o=n[r];for(const n of t){const t="maj"===n?o:o+n,i=z(D[n],r),a=i.map((t=>t?0:1)),c=i.reduce(((t,n)=>n?t+1:t));e[t]={bitMask:i,invertedMask:a,nNotes:c}}}return e}(),O=Object.keys(B);function L(n){let e,o,r;return{c(){e=s("button"),e.textContent="start"},m(t,i){c(t,e,i),o||(r=d(e,"click",n[7]),o=!0)},p:t,d(t){t&&u(e),o=!1,r()}}}function G(n){let e,o,r;return{c(){e=s("button"),e.textContent="stop"},m(t,i){c(t,e,i),o||(r=d(e,"click",n[7]),o=!0)},p:t,d(t){t&&u(e),o=!1,r()}}}function H(n){let e,r,i,g,y,b,v,$,w,x,k,A,_,C,M,F,q,E,N,j,I,T,D,S,U,z,B,O,H,P,K,R,W,J,Q,V,X,Y,Z,tt,nt,et,ot,rt,it,at,ct,ut,st=(n[2]?n[2]:"N/A")+"";function lt(t,n){return t[1]?G:L}let ft=lt(n),dt=ft(n);return{c(){e=s("main"),r=s("div"),i=s("div"),i.innerHTML='<h1><a href="https://kwsp.github.io/chord-analyser/">Chord Analyser</a></h1>',g=f(),y=s("p"),y.textContent='Press "A" or the "start" button to toggle the chord analyser. Try to play\n      a chord on the guitar or piano, pause the app right after and see how many\n      notes it got right. All processing is done in the browser and no data is\n      sent anywhere.',b=f(),v=s("br"),$=f(),w=s("div"),x=s("div"),dt.c(),k=f(),A=s("label"),_=l("Lag\n          "),C=s("input"),M=f(),F=s("input"),q=f(),E=s("label"),N=l("Thresh\n          "),j=s("input"),I=f(),T=s("input"),D=f(),S=s("label"),U=l("Influence\n          "),z=s("input"),B=f(),O=s("input"),H=f(),P=s("br"),K=f(),R=s("div"),W=s("canvas"),J=f(),Q=s("div"),V=s("p"),X=l("Chords: "),Y=l(st),Z=f(),tt=s("p"),tt.textContent=`Notes: ${n[6]?n[6]:"N/A"}`,nt=f(),et=s("p"),et.textContent="This app attempts to distinguish between the notes you are playing by 1.\n      transforming the audio to the frequency domain via FFT, 2. detecting the\n      peaks, 3. matching each peak to the closest note in the chromatic scale.",ot=f(),rt=s("p"),rt.textContent="I've always wanted something like this to analyze the sounds I hear when I\n      don't have my guitar with me (unfortunately I don't have perfect pitch),\n      and I hacked this web app together in a weekend. It is not perfect - some\n      notes might be off by a semitone, and strong overtones will be picked up.\n      If you have ideas for improvement, please let me know.",it=f(),at=s("a"),at.textContent="Github",h(i,"class","row"),h(C,"type","number"),h(C,"min","5"),h(C,"max","25"),h(F,"type","range"),h(F,"min","5"),h(F,"max","25"),h(j,"type","number"),h(j,"min","3"),h(j,"max","15"),h(j,"step","0.5"),h(T,"type","range"),h(T,"min","3"),h(T,"max","15"),h(T,"step","0.5"),h(z,"type","number"),h(z,"min","0"),h(z,"max","1"),h(z,"step","0.1"),h(O,"type","range"),h(O,"min","0"),h(O,"max","1"),h(O,"step","0.1"),h(x,"id","buttons"),h(w,"class","row"),h(W,"id","canvas"),h(W,"class","visualizer"),h(R,"class","row"),h(Q,"class","row"),h(at,"href","https://github.com/kwsp/chord-analyser/"),h(r,"class","container")},m(t,o){c(t,e,o),a(e,r),a(r,i),a(r,g),a(r,y),a(r,b),a(r,v),a(r,$),a(r,w),a(w,x),dt.m(x,null),a(x,k),a(x,A),a(A,_),a(A,C),m(C,n[3]),a(A,M),a(A,F),m(F,n[3]),a(x,q),a(x,E),a(E,N),a(E,j),m(j,n[4]),a(E,I),a(E,T),m(T,n[4]),a(x,D),a(x,S),a(S,U),a(S,z),m(z,n[5]),a(S,B),a(S,O),m(O,n[5]),a(r,H),a(r,P),a(r,K),a(r,R),a(R,W),n[15](W),a(r,J),a(r,Q),a(Q,V),a(V,X),a(V,Y),a(Q,Z),a(Q,tt),a(r,nt),a(r,et),a(r,ot),a(r,rt),a(r,it),a(r,at),ct||(ut=[d(window,"keydown",n[8]),d(C,"input",n[9]),d(F,"change",n[10]),d(F,"input",n[10]),d(j,"input",n[11]),d(T,"change",n[12]),d(T,"input",n[12]),d(z,"input",n[13]),d(O,"change",n[14]),d(O,"input",n[14])],ct=!0)},p(t,[n]){ft===(ft=lt(t))&&dt?dt.p(t,n):(dt.d(1),dt=ft(t),dt&&(dt.c(),dt.m(x,k))),8&n&&p(C.value)!==t[3]&&m(C,t[3]),8&n&&m(F,t[3]),16&n&&p(j.value)!==t[4]&&m(j,t[4]),16&n&&m(T,t[4]),32&n&&p(z.value)!==t[5]&&m(z,t[5]),32&n&&m(O,t[5]),4&n&&st!==(st=(t[2]?t[2]:"N/A")+"")&&function(t,n){n=""+n,t.wholeText!==n&&(t.data=n)}(Y,st)},i:t,o:t,d(t){t&&u(e),dt.d(),n[15](null),ct=!1,o(ut)}}}function P(t,n,e){let o,r,i=!1,a=11,c=5,u=.5;function s(t){const n=new AudioContext,o=n.createAnalyser();o.fftSize=16384,o.minDecibels=-70;n.createMediaStreamSource(t).connect(o),o.frequencyBinCount;const a=new Uint8Array(o.frequencyBinCount),c=n.sampleRate;console.log(`Sampling frequency: ${c}Hz`);const u=()=>{if(!i)return;requestAnimationFrame(u),o.getByteFrequencyData(a);const t=I(a,c,16384);if(t.reduce(((t,n)=>t+n))>40){const n=function(t){const n=new Float32Array(O.length);for(let e=0;e<O.length;e++){const o=B[O[e]].invertedMask,r=B[O[e]].nNotes;let i=0;for(let n=0;n<12;n++)i+=o[n]*t[n]*t[n];n[e]=Math.sqrt(i)/(12-r)}const e=function(t){let n=t[0],e=0;for(let o=1;o<t.length;o++)t[o]<n&&(n=t[o],e=o);return e}(n);return 0===e&&console.log(n),O[e]}(t);e(2,r=n)}};requestAnimationFrame(u)}function l(){console.log("WTF"),i?e(1,i=!1):(e(1,i=!0),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(s).catch((function(t){console.log("The following getUserMedia error occurred: "+t)})):console.log("getUserMedia not supported on your browser!"))}return b((()=>{})),[o,i,r,a,c,u,undefined,l,function(t){"KeyA"===t.code&&l()},function(){a=p(this.value),e(3,a)},function(){a=p(this.value),e(3,a)},function(){c=p(this.value),e(4,c)},function(){c=p(this.value),e(4,c)},function(){u=p(this.value),e(5,u)},function(){u=p(this.value),e(5,u)},function(t){$[t?"unshift":"push"]((()=>{o=t,e(0,o)}))}]}return new class extends class{$destroy(){!function(t,n){const e=t.$$;null!==e.fragment&&(o(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}(this,1),this.$destroy=t}$on(t,n){const e=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return e.push(n),()=>{const t=e.indexOf(n);-1!==t&&e.splice(t,1)}}$set(t){var n;this.$$set&&(n=t,0!==Object.keys(n).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),j(this,t,P,H,i,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
